<%- include('navbar.ejs') %>
<link rel="stylesheet" href="css/packages.css">

<!-- HEADER / BANNER -->
<section class="packages-header py-5"
style="background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.7)),
url('/upload/packages/<%= package_header.bg_image %>');
background-size: cover;
background-position: center;
background-attachment: fixed;">

    <div class="container py-5">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center text-white">
                <h1 class="display-4 fw-bold mb-4"><%= package_header.title %></h1>
                <p class="lead mb-4"><%= package_header.description %></p>
                <div class="d-flex justify-content-center flex-wrap gap-3">
                    <a href="#packages" class="btn btn-light btn-lg px-4">Explore Packages</a>
                    <a href="#custom" class="btn btn-outline-light btn-lg px-4">Get Custom Quote</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- PACKAGES -->
<section id="packages" class="py-5">
<div class="container">

    <div class="text-center mb-5">
        <h2 class="section-title">Our Premium Packages</h2>
        <p class="lead text-muted">Choose the perfect package that matches your vision and budget</p>
    </div>

    <div class="row g-4">
    <% packages.forEach(pkg => { %>

        <div class="col-lg-4 col-md-6">
            <div class="package-card card shadow-lg <%= pkg.type === 'Premium' ? 'popular-package' : '' %>">

                <div class="package-image">
                    <img src="/upload/packages/<%= pkg.bg_image %>" alt="<%= pkg.package_name %>">
                    <div class="package-overlay"></div>
                    <div class="package-label"><%= pkg.type %></div>
                    <div class="package-price">
                        <div class="amount">â‚¹<%= pkg.start_price %></div>
                        <div class="starting">Starting price</div>
                    </div>
                </div>

                <div class="package-body">
                    <h3 class="mb-3"><%= pkg.package_name %></h3>
                    <p class="text-muted mb-4"><%= pkg.description %></p>

                    <div class="d-flex justify-content-around mb-4">
                        <div class="text-center">
                            <div class="fw-bold text-primary fs-4"><%= pkg.max_guests %></div>
                            <small class="text-muted">Max Guests</small>
                        </div>

                        <div class="text-center">
                            <div class="fw-bold text-primary fs-4"><%= pkg.service %></div>
                            <small class="text-muted">Services</small>
                        </div>
                    </div>

                    <!-- FEATURES -->
                    <%
                    let features = [];
                    if (pkg.feature_included) {
                        features = Array.isArray(pkg.feature_included)
                          ? pkg.feature_included
                          : pkg.feature_included.split(",");
                    }
                    %>

                    <ul class="list-unstyled mb-4">
                    <% features.forEach(f => { %>
                        <li class="package-feature">
                            <i class="fas fa-check-circle"></i> <%= f.trim() %>
                        </li>
                    <% }) %>
                    </ul>

                    <!-- SUPPORT -->
                    <%
                    let supportList = [];
                    if (pkg.support) {
                        supportList = Array.isArray(pkg.support)
                          ? pkg.support
                          : pkg.support.split(",");
                    }
                    %>

                    <% supportList.forEach(s => { %>
                        <span class="badge bg-primary-subtle text-primary me-1 mb-1">
                            <i class="fas fa-headset me-1"></i> <%= s.trim() %>
                        </span>
                    <% }) %>

                   <button class="btn btn-primary w-100 mt-3"
    data-bs-toggle="modal"
    data-bs-target="#packagePreviewModal"

    data-name="<%= pkg.package_name %>"
    data-type="<%= pkg.type %>"
    data-price="<%= pkg.start_price %>"
    data-description="<%= pkg.description %>"
    data-features="<%= features.join('|') %>"
    data-support="<%= supportList.join('|') %>">
    Select <%= pkg.type %>
</button>


                </div>
            </div>
        </div>

    <% }) %>
    </div>
</div>
</section>

<!-- COMPARISON TABLE -->
<section class="py-5 bg-light">
<div class="container">

    <div class="text-center mb-5">
        <h2 class="section-title">Package Comparison</h2>
        <p class="lead text-muted">Compare features to choose the perfect package</p>
    </div>

    <div class="table-responsive">
        <table class="table feature-comparison table-hover shadow">
            <thead>
                <tr>
                    <th>Features</th>
                    <th class="text-center">Basic</th>
                    <th class="text-center">Premium</th>
                    <th class="text-center">Luxury</th>
                </tr>
            </thead>
            <tbody>
            <% features.forEach(item => { %>
                <tr>
                    <td><%= item.feature %></td>
                    <td class="text-center">
                        <i class="fas <%= item.basic ? 'fa-check check-icon' : 'fa-times times-icon' %>"></i>
                    </td>
                    <td class="text-center">
                        <i class="fas <%= item.premium ? 'fa-check check-icon' : 'fa-times times-icon' %>"></i>
                    </td>
                    <td class="text-center">
                        <i class="fas <%= item.luxury ? 'fa-check check-icon' : 'fa-times times-icon' %>"></i>
                    </td>
                </tr>
            <% }) %>
            </tbody>
        </table>
    </div>
</div>
</section>

<!-- CUSTOM PACKAGE -->
<section id="custom" class="py-5">
<div class="container">
    <div class="custom-package-section text-white p-5 rounded">
        <h2>Need a Custom Package?</h2>
        <p>Weâ€™ll tailor everything exactly to your needs.</p>
        <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#bookEventModal">
            Request Custom Quote
        </button>
    </div>
</div>
</section>

<div class="modal fade" id="packagePreviewModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">

      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="modalPackageTitle"></h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <p class="text-muted mb-3" id="modalDescription"></p>

        <div class="d-flex justify-content-between align-items-center mb-4">
          <span class="badge bg-primary fs-6" id="modalType"></span>
          <h4 class="text-primary fw-bold">â‚¹<span id="modalPrice"></span></h4>
        </div>

        <hr>

        <h6 class="fw-bold mb-2">âœ¨ Features Included</h6>
        <ul class="list-unstyled" id="modalFeatures"></ul>

        <h6 class="fw-bold mt-4 mb-2">ðŸ›Ž Support & Services</h6>
        <div id="modalSupport"></div>

      </div>

      <div class="modal-footer">
        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
        <button class="btn btn-primary" id="packageproceed">Proceed to Book</button>
      </div>

    </div>
  </div>
</div>

<script>
let selectedPackage = {};

const modal = document.getElementById('packagePreviewModal');

modal.addEventListener('show.bs.modal', function (event) {

    const button = event.relatedTarget;

    const features = button.getAttribute('data-features').split('|');
    const support = button.getAttribute('data-support').split('|');

    selectedPackage = {
        name: button.getAttribute('data-name'),
        type: button.getAttribute('data-type'),
        price: button.getAttribute('data-price'),
        description: button.getAttribute('data-description'),
        features: features,
        support: support
    };

    document.getElementById('modalPackageTitle').innerText = selectedPackage.name;
    document.getElementById('modalType').innerText = selectedPackage.type;
    document.getElementById('modalPrice').innerText = selectedPackage.price;
    document.getElementById('modalDescription').innerText = selectedPackage.description;

    // FEATURES
    const featureList = document.getElementById('modalFeatures');
    featureList.innerHTML = '';
    features.forEach(f => {
        featureList.innerHTML += `
            <li class="mb-2">
                <i class="fas fa-check-circle text-primary me-2"></i>${f}
            </li>`;
    });

    // SUPPORT
    const supportBox = document.getElementById('modalSupport');
    supportBox.innerHTML = '';
    support.forEach(s => {
        supportBox.innerHTML += `
            <span class="badge bg-primary-subtle text-primary me-2 mb-2">
                <i class="fas fa-headset me-1"></i>${s}
            </span>`;
    });
});

// âœ… PROCEED BUTTON â†’ DATA PASS à¤•à¤°à¥‚à¤¨ /book_event à¤²à¤¾ redirect
document.getElementById("packageproceed").addEventListener("click", function () {

    const query =
        "/book_event?" +
        "package_name=" + encodeURIComponent(selectedPackage.name) +
        "&type=" + encodeURIComponent(selectedPackage.type) +
        "&price=" + encodeURIComponent(selectedPackage.price) +
        "&features=" + encodeURIComponent(JSON.stringify(selectedPackage.features)) +
        "&support=" + encodeURIComponent(JSON.stringify(selectedPackage.support));

    window.location.href = query;
});
</script>




<%- include('footer.ejs') %>
