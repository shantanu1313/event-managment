<%- include('navbar.ejs') %>

<style>
  .terms-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
  }
  .terms-card h4 {
    color: #6a11cb;
    font-weight: 600;
  }
  .form-label {
    font-weight: 600;
  }
  .btn-gradient {
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    color: #fff;
    border: none;
  }
  .btn-gradient:hover {
    opacity: 0.9;
  }
</style>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-12 col-md-10">
      <div class="card terms-card p-4">

        <h4 class="mb-4">
          <i class="fas fa-file-contract me-2"></i>
          Add Terms & Conditions
        </h4>

        <form action="/admin/terms/add" method="POST" id="termsForm">

          <!-- TERM TITLE -->
          <div class="mb-3">
            <label class="form-label">Term Title</label>
            <textarea
              name="term_title"
              id="term_title"
              class="form-control"
              rows="2"
            ></textarea>
          </div>

          <!-- TERM DESCRIPTION -->
          <div class="mb-4">
            <label class="form-label">Term Description</label>
            <textarea
              name="term_content"
              id="term_content"
              class="form-control"
              rows="6"
            ></textarea>
          </div>

          <!-- BUTTONS -->
          <div class="d-flex justify-content-end gap-2">
            <a href="/admin/condition" class="btn btn-secondary">
              Cancel
            </a>
            <button type="submit" class="btn btn-gradient px-4">
              <i class="fas fa-save me-1"></i>
              Save Term
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-12">
      <div class="card terms-card p-4">

        <h4 class="mb-4">
          <i class="fas fa-list me-2"></i>
          Terms & Conditions List
        </h4>

        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle">
            <thead class="table-dark">
              <tr>
                <th style="width:60px">No</th>
                <th style="width:200px">Title</th>
                <th>Description</th>
                <th style="width:140px">Action</th>
              </tr>
            </thead>

            <tbody>
              <% if (terms && terms.length > 0) { %>

                <% terms.forEach(function(term, index) { %>
                  <tr>
                    <td><%= index + 1 %></td>

                    <td>
                      <%- term.term_title %>
                    </td>

                    <td>
                      <%- term.term_content %>
                    </td>

                    <td>
                      <a href="/admin/terms/edit/<%= term.id %>" 
                         class="btn btn-sm btn-warning mb-1">
                        <i class="fas fa-edit"></i>
                      </a>

                      <a href="/admin/terms/delete/<%= term.id %>" 
                         class="btn btn-sm btn-danger"
                         onclick="return confirm('Are you sure you want to delete this term?')">
                        <i class="fas fa-trash"></i>
                      </a>
                    </td>
                  </tr>
                <% }) %>

              <% } else { %>
                <tr>
                  <td colspan="4" class="text-center text-muted">
                    No terms & conditions added yet.
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</div>


<!-- ================= CKEDITOR CDN ================= -->
<script src="https://cdn.ckeditor.com/ckeditor5/41.3.0/classic/ckeditor.js"></script>

<!-- ================= CKEDITOR + FORM FIX ================= -->
<script>
  let titleEditor, contentEditor;

  // TITLE EDITOR
  ClassicEditor
    .create(document.querySelector('#term_title'), {
      toolbar: [
        'heading','|',
        'bold','italic','underline','|',
        'undo','redo'
      ]
    })
    .then(editor => {
      titleEditor = editor;
    })
    .catch(error => console.error(error));

  // CONTENT EDITOR
  ClassicEditor
    .create(document.querySelector('#term_content'), {
      toolbar: [
        'heading','|',
        'bold','italic','underline','strikethrough','|',
        'bulletedList','numberedList','|',
        'link','blockQuote','|',
        'undo','redo'
      ]
    })
    .then(editor => {
      contentEditor = editor;
    })
    .catch(error => console.error(error));

  // âœ… FORM SUBMIT FIX
  document.getElementById('termsForm').addEventListener('submit', function (e) {

    // CKEditor data -> textarea
    document.getElementById('term_title').value = titleEditor.getData();
    document.getElementById('term_content').value = contentEditor.getData();

    // VALIDATION
    if (!titleEditor.getData().trim()) {
      alert('Please enter Term Title');
      e.preventDefault();
      return;
    }

    if (!contentEditor.getData().trim()) {
      alert('Please enter Term Description');
      e.preventDefault();
      return;
    }
  });
</script>

<%- include('footer.ejs') %>