<%- include('navbar.ejs') %>
    
    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Fixed Top Navbar with Gradient -->
        <header class="top-navbar">
            <div class="page-title">
                <h1>Dashboard Overview</h1>
                <p>Welcome back! Here's what's happening with your events today.</p>
            </div>
            
            <div class="navbar-right">
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" placeholder="Search events, clients, payments...">
                </div>
                
                <div class="navbar-icons">
                    <div class="nav-icon">
                        <i class="far fa-bell"></i>
                        <span class="notification-badge">5</span>
                    </div>
                    <div class="nav-icon">
                        <i class="far fa-envelope"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="nav-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card stat-1">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h3>47</h3>
                        <p>Total Events</p>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>12% from last month</span>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card stat-2">
                    <div class="stat-icon">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3>â‚¹3,24,800</h3>
                        <p>Revenue This Month</p>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>18% from last month</span>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card stat-3">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3>14</h3>
                        <p>Pending Bookings</p>
                        <div class="stat-trend trend-down">
                            <i class="fas fa-arrow-down"></i>
                            <span>3% from last week</span>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card stat-4">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3>189</h3>
                        <p>Total Clients</p>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>8% from last month</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts and Events -->
            <div class="dashboard-grid">
                <!-- Revenue Chart -->
                <div class="chart-container">
                    <div class="section-header">
                        <div class="section-title-main">Revenue Overview</div>
                        <a href="#" class="section-link">View Details <i class="fas fa-chevron-right"></i></a>
                    </div>
                    <div class="chart-placeholder">
                        <i class="fas fa-chart-line gradient-icon"></i>
                        <p>Monthly Revenue Chart</p>
                        <p style="font-size: 13px; margin-top: 8px;">Interactive chart would appear here</p>
                    </div>
                </div>

                <!-- Upcoming Events -->
                <div class="upcoming-events">
                    <div class="section-header">
                        <div class="section-title-main">Upcoming Events</div>
                        <a href="#" class="section-link">View All <i class="fas fa-chevron-right"></i></a>
                    </div>
                    <ul class="events-list">
                        <li>
                            <div class="event-info">
                                <h4>Mehta Wedding Reception</h4>
                                <p><i class="far fa-calendar"></i> Today, 6:00 PM | 280 Guests</p>
                            </div>
                            <span class="event-status status-ongoing">Ongoing</span>
                        </li>
                        <li>
                            <div class="event-info">
                                <h4>TechCorp Annual Meet</h4>
                                <p><i class="far fa-calendar"></i> Tomorrow, 10:00 AM | 150 Guests</p>
                            </div>
                            <span class="event-status status-upcoming">Confirmed</span>
                        </li>
                        <li>
                            <div class="event-info">
                                <h4>Singh Birthday Party</h4>
                                <p><i class="far fa-calendar"></i> Oct 25, 7:00 PM | 90 Guests</p>
                            </div>
                            <span class="event-status status-upcoming">Confirmed</span>
                        </li>
                        <li>
                            <div class="event-info">
                                <h4>Product Launch Event</h4>
                                <p><i class="far fa-calendar"></i> Oct 28, 11:00 AM | 200 Guests</p>
                            </div>
                            <span class="event-status status-pending">Payment Due</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity">
                <div class="section-header">
                    <div class="section-title-main">Recent Activity</div>
                    <a href="#" class="section-link">View All <i class="fas fa-chevron-right"></i></a>
                </div>
                <ul class="activity-list">
                    <li>
                        <div style="display: flex; align-items: center;">
                            <div class="activity-icon activity-booking">
                                <i class="fas fa-bookmark"></i>
                            </div>
                            <div class="activity-info">
                                <h4>New booking received</h4>
                                <p><i class="far fa-clock"></i> 2 hours ago | Amit Patel - Wedding</p>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-bookmark fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- start -->

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row align-items-center">

                        <div class="col">
                            <div class="text-xs fw-bold text-info text-uppercase mb-1">
                                Book Event Linked Mobile No
                            </div>

                            <div class="h5 fw-bold text-gray-800">
                                <span id="mobileValue">
                                    <%= mobile && mobile.length> 0 ? mobile[0].mobile_no : 'Not Set' %>
                                </span>
                            </div>

                            <!-- ðŸ”˜ Edit Button -->
                            <button class="btn btn-sm btn-outline-info mt-2" data-bs-toggle="modal"
                                data-bs-target="#editMobileModal">
                                Edit
                            </button>
                        </div>

                        <div class="col-auto">
                            <i class="fas fa-phone fa-2x text-info"></i>
                        </div>

                    </div>
                </div>
            </div>
        </div>



        <div class="modal fade" id="editMobileModal" tabindex="-1">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content">

                    <form action="/admin/edit_mobile_no" method="POST">
                        <div class="modal-header">
                            <h5 class="modal-title">Edit Mobile Number</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>

                        <div class="modal-body">
                            <label class="form-label">Mobile Number</label>
                            <input type="number" class="form-control" name="mobile_no" id="modalMobileInput" required>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-success btn-sm">
                                Save
                            </button>
                        </div>

                    </form>

                </div>
            </div>
        </div>

        <script>
            const editBtn = document.querySelector('[data-bs-target="#editMobileModal"]');
            const mobileValue = document.getElementById("mobileValue");
            const modalMobileInput = document.getElementById("modalMobileInput");

            editBtn.addEventListener("click", () => {
                modalMobileInput.value = mobileValue.innerText;
            });
        </script>

        <!-- end -->

        <div class="col-xl-12 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs fw-bold text-warning text-uppercase mb-1">
                                Users
                            </div>
                            <div class="activity-info">
                                <h4>Event completed</h4>
                                <p><i class="far fa-clock"></i> 1 day ago | Corporate Seminar - 120 attendees</p>
                            </div>
                        </div>
                        <span class="activity-time">Yesterday</span>
                    </li>
                </ul>
            </div>

            <!-- Recent Bookings Table -->
            <div class="recent-bookings">
                <div class="section-header">
                    <div class="section-title-main">Recent Bookings</div>
                    <a href="#" class="section-link">View All Bookings <i class="fas fa-chevron-right"></i></a>
                </div>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Client</th>
                                <th>Event Type</th>
                                <th>Date</th>
                                <th>Guests</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>#EVT-1042</td>
                                <td>Amit Patel</td>
                                <td>Wedding</td>
                                <td>15 Oct 2023</td>
                                <td>280</td>
                                <td>â‚¹1,25,000</td>
                                <td><span class="event-status status-upcoming">Confirmed</span></td>
                                <td>
                                    <div class="booking-actions">
                                        <button class="action-btn action-view"><i class="fas fa-eye"></i></button>
                                        <button class="action-btn action-edit"><i class="fas fa-edit"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>#EVT-1041</td>
                                <td>TechCorp India</td>
                                <td>Corporate</td>
                                <td>18 Oct 2023</td>
                                <td>150</td>
                                <td>â‚¹95,000</td>
                                <td><span class="event-status status-upcoming">Confirmed</span></td>
                                <td>
                                    <div class="booking-actions">
                                        <button class="action-btn action-view"><i class="fas fa-eye"></i></button>
                                        <button class="action-btn action-edit"><i class="fas fa-edit"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>#EVT-1040</td>
                                <td>Rohan Singh</td>
                                <td>Birthday</td>
                                <td>22 Oct 2023</td>
                                <td>90</td>
                                <td>â‚¹45,000</td>
                                <td><span class="event-status status-pending">Payment Due</span></td>
                                <td>
                                    <div class="booking-actions">
                                        <button class="action-btn action-view"><i class="fas fa-eye"></i></button>
                                        <button class="action-btn action-edit"><i class="fas fa-edit"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>#EVT-1039</td>
                                <td>Innovate Labs</td>
                                <td>Product Launch</td>
                                <td>25 Oct 2023</td>
                                <td>200</td>
                                <td>â‚¹1,50,000</td>
                                <td><span class="event-status status-upcoming">Confirmed</span></td>
                                <td>
                                    <div class="booking-actions">
                                        <button class="action-btn action-view"><i class="fas fa-eye"></i></button>
                                        <button class="action-btn action-edit"><i class="fas fa-edit"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>#EVT-1038</td>
                                <td>Sunita Mehta</td>
                                <td>Anniversary</td>
                                <td>28 Oct 2023</td>
                                <td>60</td>
                                <td>â‚¹35,000</td>
                                <td><span class="event-status status-pending">Pending</span></td>
                                <td>
                                    <div class="booking-actions">
                                        <button class="action-btn action-view"><i class="fas fa-eye"></i></button>
                                        <button class="action-btn action-delete"><i class="fas fa-trash"></i></button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

    <!-- Charts -->
    <div class="row mb-4">
        <div class="col-xl-8 col-lg-7">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 fw-bold text-primary">Revenue Overview</h6>
                </div>
                <div class="card-body">
                    <div class="chart-area">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 fw-bold text-primary">Booking Sources</h6>
                </div>
                <div class="card-body">
                    <div class="chart-pie">
                        <canvas id="bookingSourceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 fw-bold text-primary">Quick Actions</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <a href="#about-management" class="btn btn-light w-100 py-3 text-start">
                                <i class="fas fa-edit text-primary me-2"></i>
                                <strong>Edit About Page</strong>
                                <small class="d-block text-muted mt-1">Update company information</small>
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="#bookings-management" class="btn btn-light w-100 py-3 text-start">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <strong>Process Bookings</strong>
                                <small class="d-block text-muted mt-1">5 pending approvals</small>
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="#events-management" class="btn btn-light w-100 py-3 text-start">
                                <i class="fas fa-plus text-info me-2"></i>
                                <strong>Add New Event</strong>
                                <small class="d-block text-muted mt-1">Create upcoming events</small>
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="#blog-management" class="btn btn-light w-100 py-3 text-start">
                                <i class="fas fa-newspaper text-warning me-2"></i>
                                <strong>Add Blog Post</strong>
                                <small class="d-block text-muted mt-1">Share latest news</small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Bookings -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 fw-bold text-primary">Recent Bookings</h6>
                    <a href="#bookings-management" class="btn btn-sm btn-primary">View All</a>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Booking ID</th>
                                    <th>Customer</th>
                                    <th>Event</th>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>#EVT-001</td>
                                    <td>John Doe</td>
                                    <td>Wedding Ceremony</td>
                                    <td>2023-06-15</td>
                                    <td>$2,499</td>
                                    <td><span class="badge bg-success">Confirmed</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>#EVT-002</td>
                                    <td>Sarah Johnson</td>
                                    <td>Corporate Conference</td>
                                    <td>2023-06-20</td>
                                    <td>$5,500</td>
                                    <td><span class="badge bg-warning">Pending</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Approve</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>#EVT-003</td>
                                    <td>Michael Chen</td>
                                    <td>Birthday Party</td>
                                    <td>2023-06-25</td>
                                    <td>$999</td>
                                    <td><span class="badge bg-info">In Progress</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Update</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Admin JS -->

    <script>
        // Charts
        const revenueCtx = document.getElementById('revenueChart').getContext('2d');
        const revenueChart = new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Revenue',
                    data: [12000, 19000, 15000, 25000, 22000, 30000],
                    borderColor: '#6a11cb',
                    backgroundColor: 'rgba(106, 17, 203, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                }
            }
        });

        const sourceCtx = document.getElementById('bookingSourceChart').getContext('2d');
        const sourceChart = new Chart(sourceCtx, {
            type: 'doughnut',
            data: {
                labels: ['Website', 'Social Media', 'Referral', 'Direct'],
                datasets: [{
                    data: [40, 25, 20, 15],
                    backgroundColor: ['#6a11cb', '#2575fc', '#ff7e5f', '#28a745'],
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });
    </script>

    <script>
        const params = new URLSearchParams(window.location.search);

        if (params.get("status") === "already_logged_in") {
            alert("You are already logged in.");
            window.history.replaceState(
                {},
                document.title,
                window.location.pathname
            );
        }

        if (params.get("status") === "logged_in") {
            alert("Admin Login successful!");
            window.history.replaceState(
                {},
                document.title,
                window.location.pathname
            );
        }
    </script>
    <%-include("footer.ejs")%>
