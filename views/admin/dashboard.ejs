<%- include('navbar.ejs') %>

<link rel="stylesheet" href="css/admin_dashboard.css">
    
            <!-- Stats Cards -->
            <div class="stats-grid">
              <div class="stat-card stat-1">
    <div class="stat-icon">
        <i class="fas fa-calendar-alt"></i>
    </div>

    <div class="stat-content">
        <h3><%= total_bookings %></h3>
        <p>Total Events</p>

        <div class="stat-trend trend-up">
            <i class="fas fa-arrow-up"></i>
            <span>Live from database</span>
        </div>
    </div>
</div>

                
                <div class="stat-card stat-2">
                    <div class="stat-icon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <div class="stat-content">
                         <div class="h5 fw-bold text-gray-800">
                                <span id="mobileValue">
                                    <%= mobile && mobile.length> 0 ? mobile[0].mobile_no : 'Not Set' %>
                                </span>
                            </div>
                        <p>whatsapp Linked  no</p>
                      
                         <button class="btn btn-sm btn-outline-info mt-2" data-bs-toggle="modal"
                                data-bs-target="#editMobileModal">
                                Edit
                            </button>
                    </div>
                </div>
                
 <div class="stat-card stat-3">
    <div class="stat-icon">
        <i class="fas fa-clock"></i>
    </div>

    <div class="stat-content">
        <h3><%= pending_count %></h3>
        <p>Pending Bookings</p>

        <div class="stat-trend trend-down">
            <i class="fas fa-arrow-down"></i>
            <span>Live from database</span>
        </div>
    </div>
</div>

                
                <div class="stat-card stat-4">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3><%= totalusers %></h3>
                         <p>Total Clients</p>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts and Events -->
            <div class="dashboard-grid">
                <!-- Revenue Chart -->
                <div class="chart-container">
                    <div class="section-header">
                        <div class="section-title-main">Revenue Overview</div>
                        <a href="#" class="section-link">View Details <i class="fas fa-chevron-right"></i></a>
                    </div>
                    <div class="chart-placeholder">
                        <i class="fas fa-chart-line gradient-icon"></i>
                        <p>Monthly Revenue Chart</p>
                        <p style="font-size: 13px; margin-top: 8px;">Interactive chart would appear here</p>
                    </div>
                </div>


                

                       <!-- Upcoming Events -->
<div class="upcoming-events">
    <div class="section-header">
        <div class="section-title-main">Upcoming Events</div>
        <a href="/admin/bookings" class="section-link">
            View All <i class="fas fa-chevron-right"></i>
        </a>
    </div>

    <ul class="events-list">

        <% if (booking_status && booking_status.length > 0) { %>

            <% booking_status.forEach(event => { %>

                <% if (event.status === 'Ongoing' || event.status === 'Confirmed') { %>

                    <li>
                        <div class="event-info">
                            <h4><%= event.event_type %></h4>
                             <h4><%= event.name %></h4>
                      
                            <p>
                                <i class="far fa-calendar"></i>
                                <%= new Date(event.start_date).toDateString() %>
                            </p>
                        </div>

                        <span class="event-status
                            <%= event.status === 'Ongoing'
                                ? 'status-ongoing'
                                : 'status-upcoming' %>">
                            <%= event.status %>
                        </span>
                    </li>

                <% } %>

            <% }) %>

        <% } else { %>
            <li class="text-muted">No upcoming events</li>
        <% } %>

    </ul>
</div>


            </div>

           


        <div class="modal fade" id="editMobileModal" tabindex="-1">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content">

                    <form action="/admin/edit_mobile_no" method="POST">
                        <div class="modal-header">
                            <h5 class="modal-title">Edit Mobile Number</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>

                        <div class="modal-body">
                            <label class="form-label">Mobile Number</label>
                            <input type="number" class="form-control" name="mobile_no" id="modalMobileInput" required>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-success btn-sm">
                                Save
                            </button>
                        </div>

                    </form>

                </div>
            </div>
        </div>

        <script>
            const editBtn = document.querySelector('[data-bs-target="#editMobileModal"]');
            const mobileValue = document.getElementById("mobileValue");
            const modalMobileInput = document.getElementById("modalMobileInput");

            editBtn.addEventListener("click", () => {
                modalMobileInput.value = mobileValue.innerText;
            });
        </script>

        <!-- end -->

        <div class="col-xl-12 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs fw-bold text-warning text-uppercase mb-1">
                                Users
                            </div>
                            <div class="activity-info">
                                <h4>Event completed</h4>
                                <p><i class="far fa-clock"></i> 1 day ago | Corporate Seminar - 120 attendees</p>
                            </div>
                        </div>
                        <span class="activity-time">Yesterday</span>
                    </li>
                </ul>
            </div>

            <!-- Recent Bookings Table -->
 <div class="recent-bookings">
    <div class="section-header">
        <div class="section-title-main">Recent Bookings</div>
        <a href="/admin/bookings" class="section-link">
            View All Bookings <i class="fas fa-chevron-right"></i>
        </a>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Sr No</th>
                    <th>Name</th>
                    <th>Mobile</th>
                    <th>Event Type</th>
                    <th>Event Dates</th>
                    <th>Budget</th>
                    <th>Status</th>
                    <th>Added On</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Example Row -->
              <% if (bookings.length === 0) { %>
<tr>
    <td colspan="9" style="text-align:center;">No recent bookings found</td>
</tr>
<% } %>
  <% bookings.forEach((b, index) => { %>
        <tr>
            <!-- SR NO -->
  <td><%= index + 1 %></td>
    <td><%= b.name %></td>

    <td><%= b.mobile %></td>

    <td><%= b.event_type %></td>

    <td>
        <%= new Date(b.start_date).toLocaleDateString('en-IN') %>
        -
        <%= new Date(b.end_date).toLocaleDateString('en-IN') %>
    </td>

    <td><%= b.budget %></td>

    <td>
        <% if (b.status === 'Confirmed') { %>
            <span class="event-status status-upcoming">Confirmed</span>
        <% } else if (b.status === 'Pending') { %>
            <span class="event-status status-pending">Pending</span>
        <% } else { %>
            <span class="event-status status-cancelled"><%= b.status %></span>
        <% } %>
    </td>

    <td>
        <%= new Date(b.created_at).toLocaleDateString('en-IN') %>
    </td>

    <td>
        <div class="booking-actions">
            <a href="/admin/edit_booking/<%= b.id %>"
               class="action-btn action-edit">
                <i class="fas fa-edit"></i>
            </a>
        </div>
    </td>
</tr>
<% }) %>



                <!-- Repeat for total 8 recent records -->
            </tbody>
        </table>
    </div>
</div>
         


  </div>
            </div>
        </div>
    <script>
        // Charts
        const revenueCtx = document.getElementById('revenueChart').getContext('2d');
        const revenueChart = new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Revenue',
                    data: [12000, 19000, 15000, 25000, 22000, 30000],
                    borderColor: '#6a11cb',
                    backgroundColor: 'rgba(106, 17, 203, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                }
            }
        });

        const sourceCtx = document.getElementById('bookingSourceChart').getContext('2d');
        const sourceChart = new Chart(sourceCtx, {
            type: 'doughnut',
            data: {
                labels: ['Website', 'Social Media', 'Referral', 'Direct'],
                datasets: [{
                    data: [40, 25, 20, 15],
                    backgroundColor: ['#6a11cb', '#2575fc', '#ff7e5f', '#28a745'],
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });
    </script>

    <script>

        const params = new URLSearchParams(window.location.search);

        if (params.get("status") === "already_logged_in") {
            alert("You are already logged in.");
            window.history.replaceState(
                {},
                document.title,
                window.location.pathname
            );
        }

        if (params.get("status") === "logged_in") {
            alert("Admin Login successful!");
            window.history.replaceState(
                {},
                document.title,
                window.location.pathname
            );
        }
    </script>
    <%-include("footer.ejs")%>
