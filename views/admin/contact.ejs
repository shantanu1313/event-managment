<%- include('navbar.ejs') %>

    <main class="main-content">

        <header class="top-navbar">
            <div class="page-title">
                <h1>Dashboard Overview</h1>
                <p>Welcome back! Here's what's happening with your events today.</p>
            </div>

            <div class="navbar-right">
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" placeholder="Search events, clients, payments...">
                </div>

                <div class="navbar-icons">
                    <div class="nav-icon">
                        <i class="far fa-bell"></i>
                        <span class="notification-badge">5</span>
                    </div>
                    <div class="nav-icon">
                        <i class="far fa-envelope"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="nav-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                </div>
            </div>
        </header>

        <div class="dashboard-content">

            <div class="container mt-5">
                <h1 class="mb-4">Contact Header Management</h1>

                <!-- ====== ADD / SAVE CONTACT HEADER FORM ====== -->
                <div class="card mb-5">
                    <div class="card-header bg-primary text-white">
                        Add New Contact Header
                    </div>
                    <div class="card-body">
                        <form action="/admin/save_contact" method="post" enctype="multipart/form-data">

                            <div class="mb-3">
                                <label class="form-label">Title</label>
                                <input type="text" class="form-control" name="title" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Subtitle</label>
                                <input type="text" class="form-control" name="subtitle" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Image</label>
                                <input type="file" class="form-control" name="contact_filename" accept="image/*">
                            </div>

                            <button type="submit" class="btn btn-success">
                                Save Contact Header
                            </button>
                        </form>
                    </div>
                </div>

                <!-- ====== HEADER + BUTTONS ====== -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>Existing Contact Headers</h2>

                    <div>
                        <button class="btn btn-success me-2" onclick="exportTableToCSV('contact_headers.csv')">
                            Export CSV
                        </button>

                        <button class="btn btn-primary" onclick="printTable()">
                            Print
                        </button>
                    </div>
                </div>

                <!-- ====== DISPLAY TABLE ====== -->
                <table class="table table-bordered table-striped" id="contactTable">
                    <thead class="table-primary">
                        <tr>
                            <th>#</th>
                            <th>Title</th>
                            <th>Subtitle</th>
                            <th>Image</th>
                            <th>Action</th>
                        </tr>
                    </thead>

                    <tbody>
                        <% if (header && header.length> 0) { %>

                            <% for (let i=0; i < header.length; i++) { %>
                                <tr>
                                    <td>
                                        <%= i + 1 %>
                                    </td>

                                    <td>
                                        <%= header[i].title %>
                                    </td>

                                    <td>
                                        <%= header[i].subtitle %>
                                    </td>

                                    <td>
                                        <% if (header[i].image) { %>
                                            <img src="/upload/contact/<%= header[i].image %>" width="80">
                                            <% } else { %>
                                                No Image
                                                <% } %>
                                    </td>


                                    <td>
                                        <a href="/admin/edit_contact/<%= header[i].id %>"
                                            class="btn btn-sm btn-primary">
                                            Edit
                                        </a>
                                        <a href="/admin/delete_contact/<%= header[i].id %>"
                                            class="btn btn-sm btn-danger">
                                            Delete
                                        </a>
                                    </td>
                                </tr>
                                <% } %>

                                    <% } else { %>

                                        <tr>
                                            <td colspan="5" class="text-center text-danger">
                                                No data available
                                            </td>
                                        </tr>

                                        <% } %>
                    </tbody>
                </table>



            </div>

            <script>
                function exportTableToCSV(filename) {
                    let csv = [];
                    let rows = document.querySelectorAll("#contactTable tr");

                    for (let i = 0; i < rows.length; i++) {
                        let row = [];
                        let cols = rows[i].querySelectorAll("th, td");

                        for (let j = 0; j < cols.length; j++) {
                            // Skip Image & Action columns
                            if (j === 3 || j === 4) continue;

                            let text = cols[j].innerText.replace(/,/g, "");
                            row.push('"' + text + '"');
                        }
                        csv.push(row.join(","));
                    }

                    let csvFile = new Blob([csv.join("\n")], { type: "text/csv" });
                    let downloadLink = document.createElement("a");

                    downloadLink.download = filename;
                    downloadLink.href = window.URL.createObjectURL(csvFile);
                    downloadLink.style.display = "none";

                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                }
            </script>

            <script>
                function printTable() {
                    let table = document.getElementById("contactTable").outerHTML;

                    let printWindow = window.open("", "", "width=900,height=650");
                    printWindow.document.write(`
        <html>
        <head>
            <title>Print Contact Headers</title>
            <style>
                body { font-family: Arial; }
                table {
                    width: 100%;
                    border-collapse: collapse;
                }
                th, td {
                    border: 1px solid #000;
                    padding: 8px;
                    text-align: left;
                }
                img {
                    max-width: 80px;
                }
                a, button {
                    display: none;
                }
            </style>
        </head>
        <body>
            <h2>Contact Headers</h2>
            ${table}
        </body>
        </html>
    `);

                    printWindow.document.close();
                    printWindow.focus();
                    printWindow.print();
                    printWindow.close();
                }
            </script>

            <%- include('footer.ejs') %>